#!/usr/bin/env bash

tmp_dex="/tmp/dexize.dex"

dexize_for_jar() {
    "${ANDROID_HOME}/build-tools/20.0.0/dx" --dex --output="$tmp_dex" "$1" > /dev/null 2>&1

    count=`cat "$tmp_dex" | head -c 92 | tail -c 4 | hexdump -e '1/4 "%d"'`
    echo "$count"
}

while [ "$1" ]; do
    if [ -d "$1" ]; then
        for jar in "${1}"/*; do
            count=`dexize_for_jar "$jar"`
            echo -e "${count}\t${jar}"
        done
    elif [ -f "$1" ]; then
        count=`dexize_for_jar "$1"`
        echo -e "${count}\t${jar}"
    fi

    shift
done

rm "$tmp_dex"
